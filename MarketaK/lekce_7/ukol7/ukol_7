import logging
from .driver_setup import create_driver
from .logger import setup_logger
from pagemodel.login_page import LoginPage
from pagemodel.inventory_page import InventoryPage

USERNAME = "problem_user"
PASSWORD = "secret_sauce"


def open_login_page(driver, logger):
    logger.info("1) OtevÃ­rÃ¡m login page...")
    login = LoginPage(driver)
    login.load()
    return login


def perform_login(login_page, logger):
    logger.info("2) ProvÃ¡dÃ­m login...")
    login_page.login_user(USERNAME, PASSWORD)


def verify_login_success(login_page, logger):
    logger.info("3) OvÄ›Å™uji ÃºspÄ›Å¡nÃ½ login...")
    login_page.verify_successful_login()


def verify_inventory_has_products(driver, logger):
    logger.info("4) Kontroluji, Å¾e inventÃ¡Å™ obsahuje produkty...")
    inventory = InventoryPage(driver)
    products = inventory.get_all_products()
    assert len(products) > 0, " InventÃ¡Å™ je prÃ¡zdnÃ½!"
    logger.info(f"NaÄtenÃ© produkty: {products}")


def test_full_login_flow():
    logger.info("=== TEST START ===")

    driver = None
    try:
        driver = create_driver()
        login = open_login_page(driver, logger)
        perform_login(login, logger)
        verify_inventory_page(driver, logger)

        print("TEST PROBÄšHL ÃšSPÄšÅ NÄš ğŸ‰ VÅ E OK!")
        logger.info("TEST SUCCESSFUL")

    except Exception as e:
        print("\nâŒ TEST SELHAL! Viz logy.")
        logger.error(f"Test selhal: {e}", exc_info=True)
        raise e

    finally:
        if driver:
            driver.quit()
            logger.info("Driver closed")
        logger.info("TEST END")
